#!/bin/bash

# Init vars

## Colors
ESC="\e["
RED=$ESC"1;31m"
GREEN=$ESC"32m"
RST="\e[0m"

## Script vars
tmp_folder=/tmp/
tmp_cmdfile=disable_wifi_cmds

# Info for the user
echo -e $RED"*=*=*=* Closing Wifi *=*=*=*"$RST

# Get root password
passwd=$(zenity --entry --hide-text --text="Closing wifi..\nRoot Password ?")

# Create tmp command file
cat > $tmp_folder/$tmp_cmdfile <<EOF
function do_it
{
	pkill wpa_supplicant
	pkill dhcpcd
	pkill wpa_gui
}
do_it
EOF

# execute the command file as root
echo $passwd | sudo -S bash /tmp/$tmp_cmdfile

# get result
result=$?

echo

echo -e $GREEN"*=*=*=* Wifi Closed *=*=*=*"$RST

notify-send "Wifi disabled" "Command to enable: 'wifi'"

exit

#####################

# removed the result check, as it can't fail...


# check result
if test "$result" -eq 0; then
	# everything worked well

	echo -e $GREEN"*=*=*=* Wifi Closed *=*=*=*"$RST

	notify-send "Wifi disabled" "Command to enable: 'wifi'"

	# TODO: execute some user scripts

else
	# error somewhere...

	echo -e $RED"*=*=*=* Error while closing wifi... *=*=*=*"$RST

	notify-send "Error: Wifi close" "Cannot disable wifi..."

fi

# reset sudo 'token'
sudo -k

# delete tmp command file
rm -f $tmp_folder/$tmp_cmdfile
