#!/bin/bash

# Init vars

## Colors
ESC="\e["
RED=$ESC"1;31m"
GREEN=$ESC"32m"
RST="\e[0m"

## Script vars
tmp_folder=/tmp/
tmp_cmdfile=enable_wifi_cmds

# Info for the user
echo -e $RED"*=*=*=* Enabling Wifi *=*=*=*"$RST

# Get root password
passwd=$(zenity --entry --hide-text --text="Enabling wifi..\nRoot Password ?")

# Create tmp command file
cat > $tmp_folder/$tmp_cmdfile <<EOF
function do_it
{
	wpa_supplicant -B -i wlo1 -c /etc/wpa_supplicant/wpa_supplicant.conf
	dhcpcd
	rfkill unblock all
}
do_it
EOF

# execute the command file as root
echo $passwd | sudo -S bash /tmp/$tmp_cmdfile

# get result
result=$?

echo

# check result
if test "$result" -eq 0; then
	# everything worked well

	echo -e $GREEN"*=*=*=* Wifi Init OK *=*=*=*"$RST

	notify-send "Wifi enabled" "Command to disable: 'nowifi'"

	# TODO: execute some user scripts

else
	# error somewhere...

	echo -e $RED"*=*=*=* Error on wifi initialization... *=*=*=*"$RST

	notify-send "Error: Wifi init" "Cannot initalize wifi..."

fi

# reset sudo 'token'
sudo -k

# delete tmp command file
rm -f $tmp_folder/$tmp_cmdfile
