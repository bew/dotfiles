#!/usr/bin/env node

/*
	by lesell_b
*/

var child_process = require("child_process");

var argv = process.argv.slice(2);

var upower_cmd = "upower -i /org/freedesktop/UPower/devices/battery_BAT0";

// To add new functionnality, just add a line in this object !
var reg = {
	state			: /state:\ *(.*)/,
	percentage_num	: /percentage:\ *([0-9]*)/,
	percentage		: /percentage:\ *(.*)/,
	present			: /present:\ *(.*)/
};

function usage () {
	console.log("== Usage =====================================================");
	console.log("$> battery        : display the standard upower output");
	console.log("$> battery help   : display this help");
	console.log("");
	console.log("$> battery thing  : display 'thing' information from upower");
	console.log("");
	console.log("     'thing' can be:");
	for (var k in reg) {
		console.log(" -> " + k);
	}
}

child_process.exec(upower_cmd, function(error, stdout, sdterr) {
	var regexp_toapply = null;

	if (argv[0] && reg[argv[0]]) {
		regexp_toapply = reg[argv[0]];
	} else if (argv[0] && argv[0] == "help") {
		usage();
		process.exit(0);
	} else {
		console.log("Try 'battery help'");
		console.log("");
		console.log(stdout);
		process.exit(0);
	}

	if (regexp_toapply) {
		console.log(regexp_toapply.exec(stdout)[1]);
	};
	process.exit(0);
});
