#compdef nix
#
# Copied from https://github.com/NixOS/nix/blob/5985b8b527560/misc/zsh/completion.zsh
# and adapted to be a zsh completion file, not just a zsh script to source.

local ifs_bk="$IFS"
local input=("${(Q)words[@]}")
IFS=$'\n'
local res=($(NIX_GET_COMPLETIONS=$((CURRENT - 1)) "$input[@]"))
IFS="$ifs_bk"
local tpe="${${res[1]}%%>	*}"
local -a suggestions
declare -a suggestions
for suggestion in ${res:1}; do
  # FIXME: This doesn't work properly if the suggestion word contains a `:`
  # itself
  suggestions+="${suggestion/	/:}"
done
if [[ "$tpe" == filenames ]]; then
  compadd -f
fi
_describe 'nix' suggestions
